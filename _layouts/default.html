<!DOCTYPE html>
<!-- #if expr="$HTTP_COOKIE=/fonts\-loaded\=true/" -->
<html lang="en" class="fonts-loaded {{ page.tag }}">
<!-- #else -->
<html lang="en" class="{{ page.tag }}">
<!-- #endif -->

{% include head.html %}

<body class="site{% if site.animated %} animated fade-in-down{% endif %}">
  <button id="theme-toggle" onclick="modeSwitcher()"></button>
  <script>
    const theme = localStorage.getItem('theme');
    if (theme === "dark") {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  </script>
  <div class="site-wrap">
    {% if page.tag != 'home' %}
        {% include header.html %}
    {% endif %}
    <div class="post px2 py2 wrap" role="main" id="{{ page.date | date: '%Y-%m-%d' }}">
      <div class="measure">
        {{ content }}
      </div>
    </div>
  </div>

  {% include footer.html %}
  <script src="/js/fontfaceobserver.js"></script>

  <script>
    var read = false;

    (function( w ){
        // if the class is already set, we're good.
        if( w.document.documentElement.className.indexOf( "fonts-loaded" ) > -1 ){
            return;
        }
        var fontA = new w.FontFaceObserver( "Merriweather", {
            weight: 300
        });
        var fontB = new w.FontFaceObserver( "Lato", {
            weight: 900
        });
        w.Promise
            .all([fontA.check(), fontB.check()])
            .then(function(){
                w.document.documentElement.className += " fonts-loaded";
                console.log('All fonts are loaded');
            }, function () {
                console.log('Web font could not be loaded in time. Falling back to system fonts.');
            });
    }( this ));
  </script>
  <script>
  const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');	

  if (theme === "dark") {
    document.getElementById("theme-toggle").innerHTML = "Light Mode";
  } else if (theme === "light") {
    document.getElementById("theme-toggle").innerHTML = "Dark Mode";
  } else if  (userPrefers === "dark") {
    document.documentElement.setAttribute('data-theme', 'dark');
    window.localStorage.setItem('theme', 'dark');
    document.getElementById("theme-toggle").innerHTML = "Light Mode";
  } else {
    document.documentElement.setAttribute('data-theme', 'light');
    window.localStorage.setItem('theme', 'light');
    document.getElementById("theme-toggle").innerHTML = "Dark Mode";
  }

  function modeSwitcher() {
    let currentMode = document.documentElement.getAttribute('data-theme');
    if (currentMode === "dark") {
      document.documentElement.setAttribute('data-theme', 'light');
      window.localStorage.setItem('theme', 'light');
      document.getElementById("theme-toggle").innerHTML = "Dark Mode";
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      window.localStorage.setItem('theme', 'dark');
      document.getElementById("theme-toggle").innerHTML = "Light Mode";
    }
  }
  </script>
</body>
</html>
